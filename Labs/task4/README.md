# Отчёт по построению архитектуры сети

## Разработка и документация адресного пространства

В рамках проекта спроектирована многоузловая сеть, включающая несколько автономных систем (AS) и филиалов:

- **Москва (AS1001)** — магистральная локация.
- **Санкт-Петербург (AS2042)** — филиал.
- **Триада (AS520)** — промежуточный узел стыковки.
- **Киторн (AS101)** — внешняя AS.
- **Ламас (AS301)** — внешняя AS.
- **Лабытнанги, Чокурдах** — удалённые филиалы.

![На изображении схема лаборатной сети](/Labs/task4/pictures/schema_network.JPG)

Для сети выделены следующие диапазоны:

- **Межмаршрутные линк-сети** — /30 (172.20.x.x, 10.10.x.x)
  
| Локация         | Устройство | Интерфейс | IP-адрес     | Маска           | Сеть            | Описание     |
|-----------------|------------|-----------|--------------|-----------------|-----------------|--------------|
| Москва          | R12        | e0/1      | 172.20.10.25 | 255.255.255.252 | 172.20.10.24/30 |              |
| Москва          | R12        | e0/2      | 172.20.10.6  | 255.255.255.252 | 172.20.10.4/30  |              |
| Москва          | R12        | e0/3      | 172.20.10.14 | 255.255.255.252 | 172.20.10.12/30 |              |
| Москва          | R13        | e0/1      | 172.20.10.26 | 255.255.255.252 | 172.20.10.24/30 |              |
| Москва          | R13        | e0/2      | 172.20.10.18 | 255.255.255.252 | 172.20.10.16/30 |              |
| Москва          | R13        | e0/3      | 172.20.10.10 | 255.255.255.252 | 172.20.10.8/30  |              |
| Москва          | R14        | e0/0      | 172.20.10.5  | 255.255.255.252 | 172.20.10.4/30  |              |
| Москва          | R14        | e0/1      | 172.20.10.9  | 255.255.255.252 | 172.20.10.8/30  |              |
| Москва          | R14        | e0/2      | 10.10.1.1    | 255.255.255.252 | 10.10.1.0/30    | Внешняя сеть |
| Москва          | R14        | e0/3      | 172.20.10.1  | 255.255.255.252 | 172.20.10.0/30  |              |
| Москва          | R15        | e0/0      | 172.20.10.17 | 255.255.255.252 | 172.20.10.16/30 |              |
| Москва          | R15        | e0/1      | 172.20.10.13 | 255.255.255.252 | 172.20.10.12/30 |              |
| Москва          | R15        | e0/2      | 10.10.1.5    | 255.255.255.252 | 10.10.1.4/30    | Внешняя сеть |
| Москва          | R15        | e0/3      | 172.20.10.21 | 255.255.255.252 | 172.20.10.20/30 |              |
| Москва          | R19        | e0/0      | 172.20.10.2  | 255.255.255.252 | 172.20.10.0/30  |              |
| Москва          | R20        | e0/0      | 172.20.10.22 | 255.255.255.252 | 172.20.10.20/30 |              |
|                 |            |           |              |                 |                 |              |
| Санкт-Петербург | R16        | e0/1      | 172.20.11.2  | 255.255.255.252 | 172.20.11.0/30  |              |
| Санкт-Петербург | R16        | e0/2      | 172.20.11.12 | 255.255.255.252 | 172.20.11.10/30 |              |
| Санкт-Петербург | R16        | e0/3      | 172.20.11.9  | 255.255.255.252 | 172.20.11.8/30  |              |
| Санкт-Петербург | R17        | e0/1      | 172.20.11.6  | 255.255.255.252 | 172.20.11.4/30  |              |
| Санкт-Петербург | R17        | e0/2      | 172.20.11.13 | 255.255.255.252 | 172.20.11.12/30 |              |
| Санкт-Петербург | R18        | e0/0      | 172.20.11.1  | 255.255.255.252 | 172.20.11.0/30  |              |
| Санкт-Петербург | R18        | e0/1      | 172.20.11.5  | 255.255.255.252 | 172.20.11.4/30  |              |
| Санкт-Петербург | R18        | e0/2      | 10.10.1.9    | 255.255.255.252 | 10.10.1.8/30    | Внешняя сеть |
| Санкт-Петербург | R18        | e0/3      | 10.10.1.13   | 255.255.255.252 | 10.10.1.12/30   | Внешняя сеть |
| Санкт-Петербург | R32        | e0/0      | 172.20.11.10 | 255.255.255.252 | 10.10.1.8/30    |              |
|                 |            |           |              |                 |                 |              |
| Триада          | R23        | e0/0      | 10.10.1.18   | 255.255.255.252 | 10.10.1.16/30   | Внешняя сеть |
| Триада          | R23        | e0/1      | 172.20.12.5  | 255.255.255.252 | 172.20.12.4/30  |              |
| Триада          | R23        | e0/2      | 172.20.12.1  | 255.255.255.252 | 172.20.12.0/30  |              |
| Триада          | R24        | e0/0      | 10.10.1.22   | 255.255.255.252 | 10.10.1.20/30   | Внешняя сеть |
| Триада          | R24        | e0/1      | 172.20.12.9  | 255.255.255.252 | 172.20.12.8/30  |              |
| Триада          | R24        | e0/2      | 172.20.12.2  | 255.255.255.252 | 172.20.12.0/30  |              |
| Триада          | R24        | e0/3      | 10.10.1.10   | 255.255.255.252 | 10.10.1.8/30    | Внешняя сеть |
| Триада          | R25        | e0/0      | 172.20.12.6  | 255.255.255.252 | 172.20.12.4/30  |              |
| Триада          | R25        | e0/1      | 10.10.1.25   | 255.255.255.252 | 10.10.1.24/30   | Внешняя сеть |
| Триада          | R25        | e0/2      | 172.20.12.13 | 255.255.255.252 | 172.20.12.12/30 |              |
| Триада          | R25        | e0/3      | 10.10.1.29   | 255.255.255.252 | 10.10.1.28/30   | Внешняя сеть |
| Триада          | R26        | e0/0      | 172.20.12.10 | 255.255.255.252 | 172.20.12.8/30  |              |
| Триада          | R26        | e0/1      | 10.10.1.33   | 255.255.255.252 | 10.10.1.32/30   | Внешняя сеть |
| Триада          | R26        | e0/2      | 172.20.12.14 | 255.255.255.252 | 172.20.12.12/30 |              |
| Триада          | R26        | e0/3      | 10.10.1.14   | 255.255.255.252 | 10.10.1.12/30   | Внешняя сеть |
|                 |            |           |              |                 |                 |              |
| Киторн          | R22        | e0/0      | 10.10.1.2    | 255.255.255.252 | 10.10.1.0/30    | Внешняя сеть |
| Киторн          | R22        | e0/1      | 10.10.1.37   | 255.255.255.252 | 10.10.1.36/30   | Внешняя сеть |
| Киторн          | R22        | e0/2      | 10.10.1.17   | 255.255.255.252 | 10.10.1.16/30   | Внешняя сеть |
|                 |            |           |              |                 |                 |              |
| Ламас           | R21        | e0/0      | 10.10.1.6    | 255.255.255.252 | 10.10.1.4/30    | Внешняя сеть |
| Ламас           | R21        | e0/1      | 10.10.1.38   | 255.255.255.252 | 10.10.1.36/30   | Внешняя сеть |
| Ламас           | R21        | e0/2      | 10.10.1.21   | 255.255.255.252 | 10.10.1.20/30   | Внешняя сеть |
|                 |            |           |              |                 |                 |              |
| Лабытнаги       | R27        | e0/0      | 10.10.1.26   | 255.255.255.252 | 10.10.1.24/30   | Внешняя сеть |
|                 |            |           |              |                 |                 |              |
| Чокурдах        | R28        | e0/0      | 10.10.1.33   | 255.255.255.252 | 10.10.1.32/30   | Внешняя сеть |
| Чокурдах        | R28        | e0/1      | 10.10.1.29   | 255.255.255.252 | 10.10.1.28/30   | Внешняя сеть |

- **Loopback интерфейсы** — /32 (10.128.x.x)

| Локация         | Устройство | IP-адрес    | Маска           |
|-----------------|------------|-------------|-----------------|
| Москва          | R12        | 10.128.0.12 | 255.255.255.255 |
| Москва          | R13        | 10.128.0.13 | 255.255.255.255 |
| Москва          | R14        | 10.128.0.14 | 255.255.255.255 |
| Москва          | R15        | 10.128.0.15 | 255.255.255.255 |
| Москва          | R19        | 10.128.0.19 | 255.255.255.255 |
| Москва          | R20        | 10.128.0.20 | 255.255.255.255 |
| Москва          | SW2        | 10.128.1.2  | 255.255.255.255 |
| Москва          | SW3        | 10.128.1.3  | 255.255.255.255 |
| Москва          | SW4        | 10.128.1.4  | 255.255.255.255 |
| Москва          | SW5        | 10.128.1.5  | 255.255.255.255 |
|                 |            |             |                 |
| Санкт-Петербург | R16        | 10.128.0.16 | 255.255.255.255 |
| Санкт-Петербург | R17        | 10.128.0.17 | 255.255.255.255 |
| Санкт-Петербург | R18        | 10.128.0.18 | 255.255.255.255 |
| Санкт-Петербург | R32        | 10.128.0.32 | 255.255.255.255 |
| Санкт-Петербург | SW9        | 10.128.1.9  | 255.255.255.255 |
| Санкт-Петербург | SW10       | 10.128.1.10 | 255.255.255.255 |
|                 |            |             |                 |
| Триада          | R23        | 10.128.0.23 | 255.255.255.255 |
| Триада          | R24        | 10.128.0.24 | 255.255.255.255 |
| Триада          | R25        | 10.128.0.25 | 255.255.255.255 |
| Триада          | R26        | 10.128.0.26 | 255.255.255.255 |
|                 |            |             |                 |
| Киторн          | R22        | 10.128.0.22 | 255.255.255.255 |
|                 |            |             |                 |
| Ламас           | R21        | 10.128.0.14 | 255.255.255.255 |
|                 |            |             |                 |
| Лабытнаги       | R27        | 10.128.0.14 | 255.255.255.255 |
|                 |            |             |                 |
| Чокурдах        | R28        | 10.128.0.28 | 255.255.255.255 |
| Чокурдах        | SW29       | 10.128.1.29 | 255.255.255.255 |

- **Пользовательские интерфейсы** — /24 (192.168.x.x)

| Локация         | Устройство | Интерфейс | VLAN | IP-адрес       | Маска         | Шлюз по умолчанию | Режим FHRP         | Описание                       |
|-----------------|------------|-----------|------|----------------|---------------|-------------------|--------------------|--------------------------------|
| Москва          | ---        | HSRP VIP  | 10   | 192.168.10.1   |               |                   |                    | HSRP VIP (gateway для VLAN10)  |
| Москва          | ---        | HSRP VIP  | 70   | 192.168.70.1   |               |                   |                    | HSRP VIP (gateway для VLAN70)  |
| Москва          | ---        | HSRP VIP  | 90   | 192.168.99.1   |               |                   |                    | HSRP VIP (gateway для VLAN99)  |
| Москва          | R12        | e0/0.10   | 10   | 192.168.10.2   | 255.255.255.0 |                   | HSRP active        |                                |
| Москва          | R12        | e0/0.70   | 70   | 192.168.70.2   | 255.255.255.0 |                   | HSRP standby       |                                |
| Москва          | R12        | e0/0.99   | 99   | 192.168.99.2   | 255.255.255.0 |                   | HSRP active        |                                |
| Москва          | R13        | e0/0.10   | 10   | 192.168.10.3   | 255.255.255.0 |                   | HSRP standby       |                                |
| Москва          | R13        | e0/0.70   | 70   | 192.168.70.3   | 255.255.255.0 |                   | HSRP active        |                                |
| Москва          | R13        | e0/0.99   | 99   | 192.168.99.3   | 255.255.255.0 |                   | HSRP standby       |                                |
| Москва          | VPC1       | NIC       | 10   | 192.168.10.10  | 255.255.255.0 | 192.168.10.1      |                    | Клиент в VLAN10                |
| Москва          | VPC7       | NIC       | 70   | 192.168.70.10  | 255.255.255.0 | 192.168.70.1      |                    | Клиент в VLAN70                |
|                 |            |           |      |                |               |                   |                    |                                |
| Санкт-Петербург | ---        | VRRP VIP  | 80   | 192.168.80.1   |               |                   |                    | VRRP VIP (gateway для VLAN80)  |
| Санкт-Петербург | ---        | VRRP VIP  | 100  | 192.168.100.1  |               |                   |                    | VRRP VIP (gateway для VLAN100) |
| Санкт-Петербург | ---        | VRRP VIP  | 199  | 192.168.199.1  |               |                   |                    | VRRP VIP (gateway для VLAN199) |
| Санкт-Петербург | R16        | e0/0.80   | 80   | 192.168.10.2   | 255.255.255.0 |                   | VRRP master        |                                |
| Санкт-Петербург | R16        | e0/0.100  | 100  | 192.168.70.2   | 255.255.255.0 |                   | VRRP backup        |                                |
| Санкт-Петербург | R16        | e0/0.199  | 199  | 192.168.99.2   | 255.255.255.0 |                   | VRRP master        |                                |
| Санкт-Петербург | R17        | e0/0.80   | 80   | 192.168.10.3   | 255.255.255.0 |                   | VRRP backup        |                                |
| Санкт-Петербург | R17        | e0/0.100  | 100  | 192.168.70.3   | 255.255.255.0 |                   | VRRP master        |                                |
| Санкт-Петербург | R17        | e0/0.199  | 199  | 192.168.99.3   | 255.255.255.0 |                   | VRRP backup        |                                |
| Санкт-Петербург | VPC        | NIC       | 100  | 192.168.100.10 | 255.255.255.0 | 192.168.100.1     |                    | Клиент в VLAN100               |
| Санкт-Петербург | VPC8       | NIC       | 80   | 192.168.80.10  | 255.255.255.0 | 192.168.80.1      |                    | Клиент в VLAN80                |
|                 |            |           |      |                |               |                   |                    |                                |
| Чокурдах        | R28        | e0/2.30   | 30   | 192.168.10.1   | 255.255.255.0 |                   |                    |                                |
| Чокурдах        | R28        | e0/2.31   | 31   | 192.168.70.1   | 255.255.255.0 |                   |                    |                                |
| Чокурдах        | R28        | e0/2.39   | 39   | 192.168.99.1   | 255.255.255.0 |                   |                    |                                |
| Чокурдах        | VPC30      | NIC       | 30   | DHCP           | DHCP          | DHCP              |                    | Клиент в VLAN30                |
| Чокурдах        | VPC31      | NIC       | 31   | DHCP           | DHCP          | DHCP              |                    | Клиент в VLAN31                |

- **Сети управления коммутаторов** — /24 (192.168.x.x, отдельный VLAN)

| Локация         | Устройство | Интерфейс | IP-адрес      | Маска         | VLAN | Описание   |
|-----------------|------------|-----------|---------------|---------------|------|------------|
| Москва          | SW2        | Vlan99    | 192.168.99.7  | 255.255.255.0 | 99   | Management |
| Москва          | SW3        | Vlan99    | 192.168.99.6  | 255.255.255.0 | 99   | Management |
| Москва          | SW4        | Vlan99    | 192.168.99.4  | 255.255.255.0 | 99   | Management |
| Москва          | Sw5        | Vlan99    | 192.168.99.5  | 255.255.255.0 | 99   | Management |
|                 |            |           |               |               |      |            |
| Санкт-Петербург | SW9        | Vlan199   | 192.168.199.4 | 255.255.255.0 | 199  | Management |
| Санкт-Петербург | SW10       | Vlan199   | 192.168.199.5 | 255.255.255.0 | 199  | Management |
|                 |            |           |               |               |      |            |
| Чокурдах        | SW29       | Vlan39    | 192.168.39.2  | 255.255.255.0 | 39   | Management |


---

## Настройка IP-адресов на активных портах

### Ниже приведен пример конфигурации для маршрутизатора (R22, Киторн):
```bash
interface Loopback0
 ip address 10.128.0.22 255.255.255.255
!
interface Ethernet0/0
 description R22-to-R4
 ip address 10.10.1.2 255.255.255.252
!
interface Ethernet0/1
 description R22-to-R21
 ip address 10.10.1.37 255.255.255.252
!
interface Ethernet0/2
 description R22-to-R23
 ip address 10.10.1.17 255.255.255.252
```

### Пример конфигурации для маршрутизатора (R12, Москва):
```bash
interface Loopback0
 ip address 10.128.0.12 255.255.255.255
!
interface Ethernet0/0
 description R12-to-SW4
 no ip address
!
interface Ethernet0/0.10
 description Clients_VLAN_10
 encapsulation dot1Q 10
 ip address 192.168.10.2 255.255.255.0
 standby version 2
 standby 10 ip 192.168.10.1
 standby 10 priority 250
 standby 10 preempt
 standby 10 track 1 decrement 50
!
interface Ethernet0/0.70
 description Clients_VLAN_70
 encapsulation dot1Q 70
 ip address 192.168.70.2 255.255.255.0
 standby version 2
 standby 10 track 1 decrement 50
 standby 70 ip 192.168.70.1
 standby 70 priority 200
 standby 70 preempt
 standby 70 track 1 decrement 50
!
interface Ethernet0/0.99
 description Management
 encapsulation dot1Q 99
 ip address 192.168.99.2 255.255.255.0
 standby version 2
 standby 10 track 1 decrement 50
 standby 99 ip 192.168.99.1
 standby 99 priority 250
 standby 99 preempt
 standby 99 track 1 decrement 50
!
interface Ethernet0/1
 description R12-to-R13
 ip address 172.20.10.25 255.255.255.252
!
interface Ethernet0/2
 description R12-to-R14
 ip address 172.20.10.6 255.255.255.252
!
interface Ethernet0/3
 description R12-to-R15
 ip address 172.20.10.14 255.255.255.252
```

---

## Настройка каждого VPC в своём VLAN

Пример для **VPC1 (Москва, VLAN10)**:
```bash
VPC1> ip 192.168.10.10/24 192.168.10.1
Checking for duplicate address...
VPC1 : 192.168.10.10 255.255.255.0 gateway 192.168.10.1
```

Пример для **VPC7 (Москва, VLAN70)**:
```bash
VPC7> ip 192.168.70.10/24 192.168.70.1
Checking for duplicate address...
VPC7 : 192.168.70.10 255.255.255.0 gateway 192.168.70.1
```

В локации Чокурдах получение адреса настроено по DHCP.

Пример для **VPC30 (Чокурдах)**:
```bash
VPC30> ip dhcp
DORA IP 192.168.30.2/24 GW 192.168.30.1
```

Пример для **VPC31 (Чокурдах)**:
```bash
VPC31> ip dhcp
DORA IP 192.168.31.2/24 GW 192.168.31.1
```

---

## Настройка VLAN и Loopback-интерфейсов управления

Для управления всеми устройствами используется выделенный **Management VLAN** и **Loopback-интерфейсы**.

Пример настройки на SW4:
```bash
interface Loopback0
 ip address 10.128.1.4 255.255.255.255

interface Vlan99
 description Management
 ip address 192.168.99.4 255.255.255.0
```

---

## Оптимизация сети и защита от broadcast штормов

- **STP (Rapid PVST)** — настроен на коммутаторах для предотвращения петель в сети и быстрого восстановления при сбоях. Обеспечивает стабильность топологии и предотвращает broadcast штормы за счёт блокировки избыточных путей. В локации "Москва (AS1001)" в качестве root bridge выставлен SW4.
- **EtherChannel (LACP) на коммутаторах SW4<->SW5 и SW9<->SW10** — объединены несколько физических портов в один логический канал. Это увеличивает пропускную способность и отказоустойчивость канала, а также снижает риск циклических петель.
- **HSRP/VRRP** — настроен на шлюзах для организации отказоустойчивого маршрутизатора. В случае отказа основного шлюза трафик автоматически переключается на резервный, что обеспечивает бесперебойную работу сети.
- **Разделение VLAN** — сеть разбита на отдельные VLAN, что изолирует широковещательный трафик внутри каждого VLAN и предотвращает распространение broadcast штормов по всей сети.

Файлы конфигурации оборудования приведены [здесь](/Labs/task4/config/).

---
