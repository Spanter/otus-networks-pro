# Отчёт по домашнему заданию «BGP. Фильтрация"

## Цель
- Настроить фильтрацию в офисе **Москва** для предотвращения транзитного трафика через AS (AS-PATH).
- Настроить фильтрацию в офисе **Санкт-Петербург** для предотвращения транзитного трафика с использованием **prefix-list**.
- Настроить провайдера **Киторн** так, чтобы офис Москва получал только **маршрут по умолчанию**.
- Настроить провайдера **Ламас** так, чтобы офис Москва получал только **маршрут по умолчанию** и **префикс офиса СПБ**.
- Обеспечить полную **IP-связность** между всеми сетями лабораторной топологии.

---

## Топология сети

![Схема лабораторной сети](/Labs/task11/pictures/schema.JPG)

### Автономные системы (AS)
| Узел            | AS   | Устройство |
|-----------------|------|------------|
| Москва          | 1001 | R14, R15   |
| Санкт-Петербург | 2042 | R18        |
| Киторн          | 101  | R22        |
| Ламас           | 301  | R21        |

### Loopback-интерфейсы (/32)
| Узел                  | Loopback IP |
|-----------------------|-------------|
| R14 (Москва)          | 10.128.0.14 |
| R15 (Москва)          | 10.128.0.15 |
| R18 (Санкт-Петербург) | 10.128.0.18 |
| R21 (Ламас)           | 10.128.0.21 |
| R22 (Киторн)          | 10.128.0.22 |

---

## Пошаговое выполнение

### Настройка фильтрации в офисе Москва (R14, R15) – **AS-PATH**

Для предотвращения транзитного трафика через офис Москва,  используем *AS-PATH access-list* чтобы запретить маршруты, содержащее AS1001. Все маршруты AS1001 не будут анонсироваться как транзитные.

**R14**

```bash
ip as-path access-list 1 deny _1001_
ip as-path access-list 1 permit .*
```

 Далее применяем фильтр к соседям BGP:

```bash
router bgp 1001
 neighbor 10.10.1.2 filter-list 1 in
 neighbor 10.10.1.2 filter-list 1 out
```
*Аналогичную настройку прописываем на маршрутизаторе R15*

---

### Настройка фильтрации в офисе Санкт-Петербург (R18) – **Prefix-list**

Для анонсирования только своих маршрутов и запрета транзитных, создаем *prefix-list* в котором прописываем только внутренние сети и Loopback R18. Все остальные сети автоматически запрещаем.

**R18**
```bash
ip prefix-list SPB-TO-BGP seq 10 permit 192.168.80.0/24
ip prefix-list SPB-TO-BGP seq 20 permit 192.168.100.0/24
ip prefix-list SPB-TO-BGP seq 30 permit 10.128.0.18/32
```

Применяем к соседям BGP:
```bash
router bgp 2042
 neighbor 10.10.1.10 prefix-list SPB-TO-BGP out
 neighbor 10.10.1.14 prefix-list SPB-TO-BGP out
```
В результате из СПБ анонсируются только свои сети, транзитный трафик отсутствует.

---

### Настройка провайдера Киторн (только default для Москвы)

Для того, чтобы офис **Москва** получал маршрут по умолчанию от провайдера **Киторн**, на *R22* используем *default-originate* и *prefix-list* 

**R22**
```bash
router bgp 101
 neighbor 10.10.1.1 default-originate
 neighbor 10.10.1.1 prefix-list ONLY-DEF out

ip prefix-list ONLY-DEF permit 0.0.0.0/0
```
- *default-originate* – анонсируем маршрут по умолчанию соседу.
- *prefix-list* - ограничивает анонс только этим маршрутом.

В результате офис **Москва** получает только *default route* от провайдера **Киторн**.

---

### Настройка провайдера Ламас (default + префикс СПБ)

Для того, чтобы офис **Москва** получал маршрут по умолчанию и префикс офиса **СПБ** от провайдера **Киторн**, на *R21* используем *default-originate* и *prefix-list* 

**R21**
```bash
router bgp 301
 neighbor 10.10.1.5 default-originate
 neighbor 10.10.1.5 prefix-list MOSOW-AND-SPB out
 
ip prefix-list MOSOW-AND-SPB seq 10 permit 0.0.0.0/0
ip prefix-list MOSOW-AND-SPB seq 20 permit 10.128.0.18/32
```

В результате офис **Москва** получает два маршрута: 
- default (0.0.0.0/0)
- префикс офиса **СПБ** (10.128.0.18/32).

---

### Проверка IP-связности

Проверяем доступность Loopback и интерфейсов офисов:

![На изображении вывод конфигурации](/Labs/task11/pictures/R15_ping_R18.JPG)

![На изображении вывод конфигурации](/Labs/task11/pictures/R15_ping_R27.JPG)

![На изображении вывод конфигурации](/Labs/task11/pictures/VPC7_ping_VPC.JPG)

Проверяем маршруты:

![На изображении вывод конфигурации](/Labs/task11/pictures/R15_sh_bgp.JPG)

![На изображении вывод конфигурации](/Labs/task11/pictures/R15_sh_route_bgp.JPG)

![На изображении вывод конфигурации](/Labs/task11/pictures/R14_sh_route_bgp.JPG)

---

## Выводы
- Настроена фильтрация маршрутов в офисе **Москва** с использованием **AS-PATH**.
- Настроена фильтрация маршрутов в офисе **Санкт-Петербург** с использованием **prefix-list**.
- Провайдер **Киторн** анонсирует только маршрут по умолчанию в Москву.
- Провайдер **Ламас** анонсирует только маршрут по умолчанию и префикс офиса СПБ в Москву.
- Полная IP-связность подтверждена проверкой ping и traceroute.

Файлы конфигурации оборудования можно найти [здесь](/Labs/task11/config/).