# Развертывание коммутируемой сети с резервными каналами

## Цели

1. Создание сети и настройка основных параметров коммутаторов.
2. Выбор корневого моста STP.
3. Наблюдение за выбором порта STP на основе стоимости.
4. Наблюдение за выбором порта STP на основе приоритета.

---

## Часть 1. Создание сети и настройка основных параметров коммутаторов

### Топология:
![На изображении схема лабораторной сети](/Labs/task2/pictures/schema.PNG)

### Таблица адресации:
| Устройство | Интерфейс | IP-адрес | Маска подсети |
|------------|------------|------------------|--------------------|
| S1 | VLAN 1 | 192.168.1.1 | 255.255.255.0 |
| S2 | VLAN 1 | 192.168.1.2 | 255.255.255.0 |
| S3 | VLAN 1 | 192.168.1.3 | 255.255.255.0 |

### Конфигурация каждого коммутатора:
```bash
enable
configure terminal
hostname S1
no ip domain-lookup
enable secret class
service password-encryption
line console 0
 password cisco
 login
 logging synchronous
 exit
line vty 0 4
 password cisco
 login
 exit
banner motd #
*********************************************************************
*                                                                   * 
*   Attention! Unauthorized access to the equipment is forbidden!   *
*                                                                   *
*********************************************************************
#
!
interface vlan 1
 ip address 192.168.1.1 255.255.255.0
 no shutdown
 exit
copy running-config startup-config
```
*(Аналогичная настройка для коммутаторов S2 и S3 с адресами указанными в таблице адресации)*

### Проверка связности (ping):
Проверяем способность устройств обмениваться эхо-запросами:
- Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2?	ДА
- Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3?	ДА
- Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3?	ДА


---

## Часть 2. Выбор корневого моста STP

### Отключаем и настраиваем транковые порты на интерфейсах всех коммутаторов:
```bash
interface  range Ethernet0/0-3
 switchport trunk encapsulation dot1q
 switchport mode trunk
 shutdown
```

### Включаем порты Ethernet0/1 и Ethernet0/3 на всех коммутаторах
```bash
interface  range Ethernet0/1, Ethernet0/3
 no shutdown
```

### Отображаем данные протокола spanning-tree:
```bash
show spanning-tree
```
На коммутаторе S1:

![На изображении результат вывода stp S1](/Labs/task2/pictures/2.4-S1-sh_stp.PNG)

На коммутаторе S2:

![На изображении результат вывода stp S2](/Labs/task2/pictures/2.4-S2-sh_stp.PNG)

На коммутаторе S3:

![На изображении результат вывода stp S3](/Labs/task2/pictures/2.4-S3-sh_stp.PNG)

### Результаты:
![На изображении схема портов stp](/Labs/task2/pictures/schema-stp.PNG)

- **Корневой мост**: Корневым мостом является коммутатор S1
- **Причина по которому этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста**: У него наименьший MAC-адрес среди всех коммутаторов при равном приоритете (32769)

### Состояния портов:

#### На S1:
- Ethernet0/1, Ethernet0/3 → Designated / FWD *(корневой мост)*

#### На S2:
- Ethernet0/1 → Root / FWD
- Ethernet0/3 → Designated / FWD

#### На S3:
- Ethernet0/1 → Alternate / BLK
- Ethernet0/3 → Root / FWD

---

## Часть 3. Наблюдение за выбором порта STP на основе стоимости *(cost)*

Изменяем cost на порту **S3**:
```bash
interface Ethernet0/3
 spanning-tree cost 90
```

### Результат изменения cost:

На S2:

![На изображении результат вывода stp S2](/Labs/task2/pictures/3.3-S2-sh_stp.PNG)

На S3:

![На изображении результат вывода stp S3](/Labs/task2/pictures/3.3-S3-sh_stp.PNG)

### Объяснение:
STP выбрал новый, более короткий путь через S3, поскольку стоимость порта на интерфейсе Ethernet0/3 составляет 90 (по умолчанию на всех портах cost=100). Поэтому был заблокирован менее предпочтительный порт на S2 *(Ethernet0/3)*.

---

## Часть 4. Наблюдение за выбором порта STP на основе стоимости

Включение всех портов:
```bash
interface range Ehternet0/0, Ehternet0/2
 no shutdown
```

### Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов:

![На изображении результат вывода stp S2](/Labs/task2/pictures/4.0-S2-sh_stp.PNG)

![На изображении результат вывода stp S3](/Labs/task2/pictures/4.0-S3-sh_stp.PNG)

### Вывод:
- **Root Port на S2**: Ethernet0/0
- **Root Port на S3**: Ethernet0/2

На некорневых коммутаторах (S2, S3) Root Port стал порт с **меньшим номером**, потому что при равной стоимости, STP сравнивает Port ID.

---

## Вопросы для повторения

1. **Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?**  Суммарная стоимость пути до корневого моста *(Path Cost)*. STP выберет порт с наименьшей стоимостью.
2. **Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?**  Bridge ID отправителя (Designated Bridge ID). STP выберет порт, через который приходит BPDU с меньшим Bridge ID *(Bridge ID = приоритет моста + MAC-адрес)*.
3. **Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?**   Port ID. STP выберет порт, через который приходит BPDU с меньшим Port ID *(Port ID = port-priority + port-number)*.

Файлы конфигурации оборудования приведены [здесь](/Labs/task2/config/).


