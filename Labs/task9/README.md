# Отчёт по настройке eBGP

## Цель
- Настроить eBGP между офисами и провайдерами.
- Обеспечить IP-доступность между офисами Москва и Санкт-Петербург.
- Научиться анонсировать маршруты через BGP и проверять их доступность.

---

## Топология сети

![На изображении схема лаборатной сети](/Labs/task9/pictures/schema.JPG)

### Автономные системы (AS)
| Узел            | AS   | Устройство |
|-----------------|------|------------|
| Москва          | 1001 | R14, R15   |
| Санкт-Петербург | 2042 | R18        |
| Киторн          | 101  | R22        |
| Ламас           | 301  | R21        |
| Триада          | 520  | R24, R26   |


### Loopback-интерфейсы (/32)
| Узел                  | Loopback IP |
|-----------------------|-------------|
| R14 (Москва)          | 10.128.0.14 |
| R15 (Москва)          | 10.128.0.15 |
| R22 (Киторн)          | 10.128.0.22 |
| R18 (Санкт-Петербург) | 10.128.0.18 |
| R21 (Ламас)           | 10.128.0.21 |
| R24 (Триада)          | 10.128.0.24 |
| R26 (Триада)          | 10.128.0.26 |

---

## План работы

**Настраиваем eBGP между офисами Москва/Санкт-Петербург и провайдерами для обеспечения обмена маршрутами**
  
Для обеспечения обмена маршрутами офисов с внешними провайдерами, на офисных роутерах **R14**, **R15** и **R18** создаём eBGP-сессии с соседними провайдерами и анонсируем свои сети. Провайдеры должны выполнять транзит маршрутов в целях обеспечения связи Москвы и Санкт-Петербурга. 
В конфигурации для *router-id* в качестве индентификатора задаем адрес Loopback интерефейса. Командой *neighbor* указываем каждого соседа. Для распространения информации о маршрутах к пограничным роутерам, прописываем анонс Loopback.

1) Настройка eBGP на маршрутизаторе офиса:

**R14**
```bash
router bgp 1001
 bgp router-id 10.128.0.14
 bgp log-neighbor-changes
 network 10.10.1.0 mask 255.255.255.252 # выполняем анонсирование P2P линк  до Ламас
 network 10.128.0.14 mask 255.255.255.255 
 neighbor 10.10.1.2 remote-as 101
 neighbor 10.10.1.2 description To-Kitorn
```
*Аналогичную настройку для офиса Москва выполняем на маршрутизаторе R15 c анонсированием до Киторн*

 **R18**
```bash
router bgp 2042
 bgp router-id 10.128.0.18
 bgp log-neighbor-changes
 network 10.10.1.8 mask 255.255.255.252 # выполняем анонсирование P2P линк  до Триада
 network 10.10.1.12 mask 255.255.255.252 # выполняем анонсирование P2P линк  до Триада
 network 10.128.0.18 mask 255.255.255.255
 neighbor 10.10.1.10 remote-as 520
 neighbor 10.10.1.10 description To-Triada
 neighbor 10.10.1.14 remote-as 520
 neighbor 10.10.1.14 description To-Triada
 ```

2) Настройка eBGP на маршрутизаторе провайдера:

**R21**
```bash
router bgp 301
 bgp router-id 10.128.0.21
 bgp log-neighbor-changes
 neighbor 10.10.1.5 remote-as 1001
 neighbor 10.10.1.5 description To_Moscow
 neighbor 10.10.1.22 remote-as 520
 neighbor 10.10.1.22 description To-Triada
 neighbor 10.10.1.37 remote-as 101
 neighbor 10.10.1.37 description To-Kitorn
```

**R22**
```bash
router bgp 101
 bgp router-id 10.128.0.22
 bgp log-neighbor-changes
 neighbor 10.10.1.1 remote-as 1001
 neighbor 10.10.1.1 description To-Moscow
 neighbor 10.10.1.38 remote-as 301
 neighbor 10.10.1.38 description To-Lamas
```

**R24**
```bash
router bgp 520
 bgp router-id 10.128.0.24
 bgp log-neighbor-changes
 neighbor 10.10.1.9 remote-as 2042
 neighbor 10.10.1.9 description To-SPB
 neighbor 10.10.1.21 remote-as 301
 neighbor 10.10.1.21 description To-Lamas
```
*Аналогичную настройку в Триаде  выполняем на маршрутизатора R26*


## Проверка работы

Для обспечения сквозной IP-доступности между R14/R15 и R18, убеждаемся, что трафик может пройти через всю топологию. Для этого выполняем проверяем BGP-таблицы, делаем ping и traceroute.


### Проверка маршрутов

Проверяем офисные маршруты что они видят друг друга и маршруты провайдеров транзитируют корректно.

![На изображении вывод конфигурации](/Labs/task9/pictures/R14_sh_bgp.JPG)

![На изображении вывод конфигурации](/Labs/task9/pictures/R18_sh_bgp.JPG)



### Тестирование доступности

Убеждаемся, что пакеты доходят от Москвы до Санкт-петербурга и обратно.

![На изображении вывод конфигурации](/Labs/task9/pictures/R14_ping.JPG)

![На изображении вывод конфигурации](/Labs/task9/pictures/R15_ping.JPG)

![На изображении вывод конфигурации](/Labs/task9/pictures/R18_ping.JPG)


### Трассировка (traceroute)

Проверяем путь пакета в офисе Москва.

![На изображении вывод конфигурации](/Labs/task9/pictures/R14_trace.JPG)

---

## Выводы

- Настроены eBGP-сессии между офисами и провайдерами.
- Проверена доступность всех интерфейсов Loopback и P2P-линий.
- Обеспечена сквозная IP-доступность между Москвой и Санкт-Петербурга.

Файлы конфигурации оборудования приведены [здесь](/Labs/task9/config/).